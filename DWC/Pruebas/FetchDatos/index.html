<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="fetch.js"></script>
</head>

<body>
    <script>

        let codigos = {
            Bizkaia: {
                ID: 48,
                Ciudades: {
                    Bilbao: 48020,
                    Barakaldo: 48013
                }

            },
            Gipuzkoa: {
                ID: 20,
                Ciudades: {
                    Zarautz: 20079,
                    Irun: 20045,
                    Errenteria: 20067,
                    Donosti: 20069
                }
            },
        }

        let ciudades = new Object()

        let fetchURL = `http://185.60.40.210/dwc/Aimar/Proyecto/recibirDatosBase.php`
        fetch(fetchURL)
            .then(response => {
                if (!response.ok) {
                    throw new Error("La solicitud no se pudo completar correctamente.");
                }
                return response.json();
            })
            .then(data => {
                ciudades = data

            })
        setTimeout(() => {
            ciudades.forEach(ciudad => {
                ciudad["temperatura"] = parseInt(ciudad["temperatura"]) + (Math.round(Math.random()) * 2 - 1)
                ciudad["humedad"] = parseInt(ciudad["humedad"]) + ((Math.round(Math.random()) * 2 - 1) < 0 ? 1 : (Math.round(Math.random()) * 2 - 1))
                ciudad["lluvia"] = parseInt(ciudad["lluvia"]) + ((Math.round(Math.random()) * 2 - 1) < 0 ? 1 : (Math.round(Math.random()) * 2 - 1))
                ciudad["viento"] = parseInt(ciudad["viento"]) + ((Math.round(Math.random()) * 2 - 1) < 0 ? 1 : (Math.round(Math.random()) * 2 - 1))
                ciudad["precipitacion"] = parseInt(ciudad["precipitacion"]) + ((Math.round(Math.random()) * 2 - 1) < 0 ? 1 : (Math.round(Math.random()) * 2 - 1))
            });
            
            for (let ciudad of ciudades) {
                fetch(`http://185.60.40.210/dwc/Aimar/Proyecto/actualizarBaseDatos.php?ciudad=` + JSON.stringify(ciudad))
                        //`http://10.10.17.121:8083/Aimar/actualizarBaseDatos.php?ciudad=` + JSON.stringify(ciudad)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("La solicitud no se pudo completar correctamente.");
                    }
                    return response.text();
                })
                .then(data => {
                })
            }
           
        }, 50);
    </script>
</body>

</html>